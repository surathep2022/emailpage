<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel of Fortune - Inventory System</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Kanit', sans-serif; display: flex; flex-direction: column; align-items: center; background: #f4f7f6; padding-bottom: 50px; }
        .wheel-container { position: relative; width: 400px; margin: 50px auto; }
        #wheel { border-radius: 50%; box-shadow: 0 0 30px rgba(0,0,0,0.15); transition: transform 4s cubic-bezier(0.1, 0, 0.2, 1); background: #fff; }
        #spin-btn {
            display: block; margin: 25px auto; padding: 15px 50px;
            font-size: 1.5rem; font-weight: bold; color: white;
            background-color: #e74c3c; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px #c0392b;
        }     
          
        #spin-btn:hover {
            background-color: #ff4d4d;
            transform: scale(1.05);
            transition: 0.2s;
        }
  
        #spin-btn:disabled { background-color: #bdc3c7; box-shadow: none; transform: translateY(3px); }
        #arrow {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 20px solid transparent;
            border-right: 20px solid transparent; border-top: 40px solid #2c3e50;
            z-index: 10;
        }
        .info-panel { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; width: 350px; margin-bottom: 20px; }
        .history-box { width: 350px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        #history-list { list-style: none; padding: 0; max-height: 200px; overflow-y: auto; }
        #history-list li { padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .swal2-popup { font-family: 'Kanit', sans-serif !important; }
        
    </style>
</head>
<body>

    <div class="info-panel">
        <div>‡∏´‡∏°‡∏∏‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà: <span id="display-count">0</span> / 100</div>
        <div>‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="display-bags">85</span> ‡πÉ‡∏ö</div>
    </div>

    <div class="wheel-container">
        <div id="arrow"></div>
        <canvas id="wheel" width="400" height="400"></canvas>
        <button id="spin-btn" style="font-family: 'Kanit', sans-serif">‡∏´‡∏°‡∏∏‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•!</button>
    </div>

    <div class="history-box">
        <h3 style="text-align:center">üèÜ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
        <ul id="history-list"><li style="color: #999; text-align:center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</li></ul>
    </div>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô JavaScript ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà ---
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const btn = document.getElementById('spin-btn');
        const listElement = document.getElementById('history-list');

        const prizes = ["‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ú‡πâ‡∏≤", "‡πÅ‡∏Å‡πâ‡∏ß‡∏ô‡πâ‡∏≥", "‡∏ú‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏î‡∏ï‡∏±‡∏ß", "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì", "‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏ü‡∏£‡∏µ", "Gift Box"];
        const colors = ["#FF5733", "#33FF57", "#3357FF", "#F333FF", "#c7bd00", "#33FFF3"];

        let currentRotation = 0; // ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏á‡∏®‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        let isSpinning = false;
        let totalSpinsInRound = 0;
        let bagsLeft = 50;

        function drawWheel() {
            const sliceAngle = (2 * Math.PI) / prizes.length;
            prizes.forEach((prize, i) => {
                ctx.beginPath();
                ctx.fillStyle = colors[i];
                ctx.moveTo(200, 200);
                ctx.arc(200, 200, 200, i * sliceAngle, (i + 1) * sliceAngle);
                ctx.fill();
                ctx.save();
                ctx.translate(200, 200);
                ctx.rotate(i * sliceAngle + sliceAngle / 2);
                ctx.fillStyle = "#fff";
                ctx.textAlign = "right";
                ctx.font = "bold 16px 'Kanit'";
                ctx.fillText(prize, 180, 8);
                ctx.restore();
            });
        }

        btn.addEventListener('click', () => {
            if (isSpinning) return;
            
            isSpinning = true;
            btn.disabled = true;
            totalSpinsInRound++;

            let targetIdx;
            const spinsRemainingInRound = 101 - totalSpinsInRound;
            
            // ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏•‡πá‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
            if (bagsLeft > 0 && (Math.random() < (bagsLeft / spinsRemainingInRound) || bagsLeft >= spinsRemainingInRound)) {
                targetIdx = 0; // ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ú‡πâ‡∏≤
                bagsLeft--;
            } else {
                targetIdx = Math.floor(Math.random() * (prizes.length - 1)) + 1;
            }

            // --- ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡πâ‡∏•‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏≠‡∏î‡∏µ ---
            const sectionAngle = 360 / prizes.length;
            
            // 1. ‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏®‡∏©‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (0-359)
            const currentActualAngle = currentRotation % 360;
            
            // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏á‡∏®‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á targetIdx ‡πÑ‡∏õ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà 270 ‡∏≠‡∏á‡∏®‡∏≤ (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏Ç‡πá‡∏°)
            // ‡∏™‡∏π‡∏ï‡∏£: ((‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏Ç‡πá‡∏° - ‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢) - ‡∏≠‡∏á‡∏®‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô + 360) % 360
            const targetCenterAngle = (targetIdx * sectionAngle) + (sectionAngle / 2);
            let angleToMove = (270 - targetCenterAngle - currentActualAngle + 1440) % 360;
            
            // 3. ‡∏ö‡∏ß‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 5 ‡∏£‡∏≠‡∏ö = 1800 ‡∏≠‡∏á‡∏®‡∏≤)
            const finalSpinAngle = angleToMove + 1800;
            
            currentRotation += finalSpinAngle;
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            document.getElementById('display-count').textContent = totalSpinsInRound;
            document.getElementById('display-bags').textContent = bagsLeft;

            setTimeout(() => {
                isSpinning = false;
                btn.disabled = false;
                const result = prizes[targetIdx];
                updateHistory(result, totalSpinsInRound);

                Swal.fire({
                    title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!',
                    html: `‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: <b style="color:#e74c3c">${result}</b>`,
                    icon: 'success',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                }).then(() => {
                    if (totalSpinsInRound >= 100) {
                        Swal.fire('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà!', '‡∏´‡∏°‡∏∏‡∏ô‡∏Ñ‡∏£‡∏ö 100 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏õ‡πá‡∏ô 50 ‡πÉ‡∏ö', 'info');
                        totalSpinsInRound = 0;
                        bagsLeft = 50;
                        document.getElementById('display-count').textContent = "0";
                        document.getElementById('display-bags').textContent = "50";
                    }
                });
            }, 4000);
        });

        function updateHistory(prize, count) {
            if (count === 1) listElement.innerHTML = '';
            const li = document.createElement('li');
            li.innerHTML = `<span>#${count}</span> <b>${prize}</b>`;
            listElement.insertBefore(li, listElement.firstChild);
        }

        drawWheel();

        // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î ---
        window.addEventListener('keydown', (event) => {
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Spacebar (‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠ " ") ‡∏´‡∏£‡∏∑‡∏≠ Enter
            if (event.key === " " || event.key === "Enter") {
                
                // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏î Spacebar ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á)
                event.preventDefault(); 
                
                // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏á‡∏•‡πâ‡∏≠‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏°‡∏∏‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å Disable ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô
                if (!isSpinning && !btn.disabled) {
                    btn.click(); // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏°‡∏≤‡∏™‡πå
                }
            }
        });

  </script>
</body>
</html>